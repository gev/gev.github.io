<!DOCTYPE html >
<html>
<head>
    <style>

        * {
            margin: 0;
            padding: 0;
            overflow: hidden;
            user-select: none;
        }

        html, body {
            width: 100%;
            height: 100%;
        }

        object {
            top: 0;
            left: 0;
            height: 100%;
            position: absolute;
            pointer-events: none;
            will-change: left;
            transition-property: left;
            animation-timing-function: ease-in-out
        }

        #de, #di {
            left: 0;
            width: 100%;
            position: absolute;
        }

        #de {
            top: 0;
            height: 32.2%;
        }

        #di {
            top: 27.2%;
            height: 72.4%;
        }

        .scroller {
            top: 50%;
            padding: 20px;
            position: absolute;
            border: none;
            background: transparent;
            cursor: pointer;
            outline: 0;
            color: white;
            font-size: 75px;
            text-shadow: black 0 0 20px;
            opacity: 0.75;
            box-shadow: none;
        }

        .scroller:hover {
            opacity: 1;
            font-size: 80px;
        }

        #bl {
            left: 0;
        }

        #br {
            right: 0;
        }

    </style>
</head>

<body>
<div id='de'>
    <object id='oe' type='image/svg+xml' data='equipment.svg'>
        Your browser does not support SVG
    </object>
</div>
<div id='di'>
    <object id='oi' type='image/svg+xml' data='interior.svg'>
        Your browser does not support SVG
    </object>
</div>
<button id='bl' class='scroller'>❮</button>
<button id='br' class='scroller'>❯</button>

<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery.touchswipe/1.6.18/jquery.touchSwipe.min.js'></script>

<script>

    var id;

    function sync(src, dst, x) {
        var k = (dst.offsetWidth - document.body.clientWidth)
              / (src.offsetWidth - document.body.clientWidth);
        dst.style.left = Math.round(x * k) + 'px'
    }

    function shift(src, dst, dx, dt) {
        cancelAnimationFrame(id);
        dt += 'ms';
        src.style.transitionDuration = dt;
        dst.style.transitionDuration = dt;
        var l = document.body.clientWidth - src.offsetWidth;
        var x = src.offsetLeft - dx;
        x = x > 0 ? 0 : x < l ? l : x;
        src.style.left = x + 'px';
        sync(src, dst, x)
    }

    function scroll(src, dst) {
        return function (e) {
            if (e.deltaY * e.deltaY > e.deltaX*e.deltaX)
                return true;
            var dx = e.deltaX * e.deltaFactor;
            shift(src, dst, dx, 0);
            return false;
        }
    }

    function dx(src) {
        var n = src.offsetWidth / document.body.clientWidth;
        var m = Math.floor(n);
        if (n > m) m++;
        return Math.round(src.offsetWidth / m)
    }

    function swipe(src, dst, d) {
        return function () {
            shift(src, dst, d * dx(oi), 500)
        }
    }

    function move(src, dst) {
        return function (e) {
            var touch = e.originalEvent.targetTouches[0];
            var dx = src.touch.pageX - touch.pageX;
            var dy = src.touch.pageY - touch.pageY;
            src.v .push(dx / (e.timeStamp - src.t));
            if (src.v.length > 3) src.v.shift();
            src.t = e.timeStamp;
            src.touch = touch;
            if (dy * dy > dx * dx) return true;
            shift(src, dst, dx, 0);
            return false;
        }
    }

    function start(src) {
        return function (e) {
            src.touch = e.originalEvent.targetTouches[0];
            src.t = e.timeStamp;
            src.v = [0, 0];
        }
    }

    function end(src, dst) {
        return function () {
            console.log(src.v);
            var t0 = performance.now();
            var v0 = v = src.v.reduce(function(a, b) {return a + b}) / src.v.length;
            var a = (v > 0 ? -1 : 1) / 400;
            console.log('->', v);
            function step() {
                var t1 = performance.now();
                var dt = (t1 - t0);
                var dx = v * dt;
                v += a * dt;
                console.log(v, dx, dt);
                if (v0 * v <= 0) return;
                t0 = t1;
                shift(src, dst, dx, 0);
                id = requestAnimationFrame(step);
            }
            id = requestAnimationFrame(step);
        }
    }

    var oe = $('#oe')[0];
    var oi = $('#oi')[0];

    $('#bl').click(swipe(oi, oe, -1));
    $('#br').click(swipe(oi, oe, 1));

    $('#di')
        .on('touchstart', start(oi))
        .on('touchmove', move(oi, oe))
        .on('touchend', end(oi, oe))
        .mousewheel(scroll(oi, oe));
    $('#de')
        .on('touchstart', start(oe))
        .on('touchmove', move(oe, oi))
        .on('touchend', end(oe, oi))
        .mousewheel(scroll(oe, oi));


</script>
</body>
</html>
